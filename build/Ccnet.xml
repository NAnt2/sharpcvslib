<project name="Ccnet" default="Build">
    <property name="frameworks" value="net-1.1 mono-1.0"/>
    <target name="Build">
        <call target="CreateBuildText"/>
        <foreach item="String" in="${frameworks}" property="framework" delim=" ">
            <nant buildfile="SharpCvsLib.build" target="clean dist" verbose="true" inheritall="false">
                <properties>
                    <property name="nant.settings.currentframework" value="${framework}" readonly="true" />
                </properties>
            </nant>
            
            <zip zipfile="${dir.ccnet.log}/${label-to-apply}/SharpCvsLib-${framework}-${platform-get-name()}.zip">
                <fileset basedir="${dir.dist}/src">
                    <include name="**" />
                    <exclude name=".externalToolBuilders/**"/>
                </fileset>
                <fileset basedir="${dir.dist}/bin" prefix="bin">
                    <include name="bin/**"/>
                </fileset>
                <fileset basedir="${dir.ccnet.log}">
                    <include name="build.txt" />
                </fileset>
            </zip>
        </foreach>
        
        <if test="${property::exists('dir.ccnet.log')}">
            <!--  
                You will need to download junction (for symlinks) here: 
                http://www.sysinternals.com/ntw2k/source/misc.shtml#junction 
            -->
            <exec program="junction.exe">
                <arg value="-d"/>
                <arg value="${dir.ccnet.log}/latest"/>
            </exec>
            <exec program="junction.exe">
                <arg value="${dir.ccnet.log}/latest"/>
                <arg value="${dir.ccnet.log}/${label-to-apply}"/>
            </exec>
        </if>    
    </target> 
    
    <target name="CreateBuildText">
            <sysinfo/>            
            <echo file="${dir.ccnet.log}/${label-to-apply}/build.txt">
Sporadicism Build Server (http://www.build.sporadicism.com)
-----------------------------------------------------------

Computer:   ${sys.env.COMPUTERNAME}
Date:       ${datetime::now()}
Label:      ${label-to-apply}
Frameworks: ${frameworks}
OS:         ${environment::get-operating-system()}
            
            </echo>
    </target>
</project>